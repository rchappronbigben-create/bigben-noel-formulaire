<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>ðŸŽ„ Tirage au sort NoÃ«l â€” Bigben Connected (1 â†’ 20 dÃ©c. 2025)</title>
<style>
:root{
  --bb-red:#b8001f;
  --bb-red-light:#e63b3b;
  --bb-white:#ffffff;
  --bb-gold:#d4af37;
  --bb-text:#111;
}
body{
  margin:0;
  font-family:"Segoe UI",Roboto,Arial,sans-serif;
  background:linear-gradient(180deg,var(--bb-red) 0%,var(--bb-white) 100%);
  color:var(--bb-text);
  min-height:100vh;
  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:flex-start;
  padding:40px 10px 80px;
  position:relative;
}
.card{
  background:#fff;
  border:3px solid var(--bb-gold);
  border-radius:18px;
  box-shadow:0 8px 30px rgba(0,0,0,.2);
  max-width:720px;
  width:100%;
  padding:32px;
}
header{text-align:center;margin-bottom:10px;}
.logo{width:180px;height:auto;margin-bottom:6px;}
h1{font-size:1.7rem;color:var(--bb-red);margin-bottom:0;}
.subtitle{margin-top:4px;font-weight:600;color:#444}
.prizes{
  background:#fff7eb;border:1px dashed var(--bb-gold);
  border-radius:12px;padding:10px 14px;margin:16px auto;max-width:600px;text-align:left;
}
form{margin-top:10px;}
.grid{display:grid;gap:14px;grid-template-columns:1fr 1fr;}
.full{grid-column:1/-1;}
label{display:block;font-weight:600;margin-bottom:4px;text-align:left;}
input,select{
  width:100%;padding:10px 12px;border:1px solid #ccc;border-radius:8px;font-size:15px;
}
input:focus,select:focus{outline:none;border-color:var(--bb-red-light);box-shadow:0 0 0 3px rgba(184,0,31,.15);}
button{
  margin-top:8px;padding:13px 24px;background:var(--bb-red);
  color:#fff;font-weight:700;border:none;border-radius:10px;font-size:16px;
  box-shadow:0 8px 20px rgba(0,0,0,.2);cursor:pointer;
}
button:hover{background:#8d0018;}
.error{color:#b00020;font-size:13px;text-align:left;display:none;}
footer{
  position:absolute;
  bottom:12px;
  left:0;
  width:100%;
  text-align:center;
  color:#fff;
  font-size:13px;
  opacity:.85;
}
@media(max-width:640px){.grid{grid-template-columns:1fr;}}
</style>
</head>
<body>
  <div class="card">
    <header>
      <img src="BIGBEN.png" alt="Bigben Connected" class="logo">
      <h1>ðŸŽ„ Tirage au sort NoÃ«l â€” Bigben Connected</h1>
      <p class="subtitle"><strong>Participation du 1 au 20 dÃ©cembre 2025</strong></p>
      <div class="prizes">
        <strong>3 lots Ã  gagner :</strong>
        <ul style="margin:6px 0 0 18px;">
          <li>ðŸ¥‡ Appareil photo Polaroid (149 â‚¬)</li>
          <li>ðŸ¥ˆ Enceinte Bluetooth (99 â‚¬)</li>
          <li>ðŸ¥‰ Ã‰couteurs sans fil FORCE (79 â‚¬)</li>
        </ul>
      </div>
    </header>

    <form id="jeuForm" novalidate>
      <div class="grid">
        <div>
          <label for="nom">Nom</label>
          <input id="nom" name="Nom" type="text" placeholder="Ex : Durand" required>
          <div class="error" id="errNom">Veuillez renseigner votre nom.</div>
        </div>

        <div>
          <label for="prenom">PrÃ©nom</label>
          <input id="prenom" name="PrÃ©nom" type="text" placeholder="Ex : Marie" required>
          <div class="error" id="errPrenom">Veuillez renseigner votre prÃ©nom.</div>
        </div>

        <div class="full">
          <label for="email">E-mail</label>
          <input id="email" name="Email" type="email" placeholder="Ex : marie@email.com" required>
          <div class="error" id="errEmail">Adresse e-mail invalide.</div>
        </div>

        <div>
          <label for="tel">TÃ©lÃ©phone</label>
          <input id="tel" name="TÃ©lÃ©phone" type="tel" inputmode="numeric" placeholder="Ex : 06 12 34 56 78" required>
          <div class="error" id="errTel">NumÃ©ro invalide.</div>
        </div>

        <div class="full">
          <label for="magasin">Magasin</label>
          <select id="magasin" name="Magasin" required>
            <option value="">-- SÃ©lectionnez votre magasin --</option>
            <option value="Leclerc Bourgoin-Jallieu">Leclerc Bourgoin-Jallieu</option>
          </select>
          <div class="error" id="errMagasin">Veuillez sÃ©lectionner un magasin.</div>
        </div>

        <div>
          <label for="montant">Montant dâ€™achat Bigben (â‚¬)</label>
          <input id="montant" name="Montant (â‚¬)" type="number" min="20" step="1" placeholder="Ex : 20" required>
          <div class="error" id="errMontant">Montant minimum 20 â‚¬.</div>
        </div>

        <div>
          <label for="date">Date dâ€™achat</label>
          <input id="date" name="Date dâ€™achat" type="date" min="2025-12-01" max="2025-12-20" required>
          <div class="error" id="errDate">Date entre le 01 et le 20/12/2025.</div>
        </div>

        <div class="full">
          <label for="ticket">Photo du ticket (JPG/PNG/PDF)</label>
          <input id="ticket" name="Ticket" type="file" accept=".jpg,.jpeg,.png,.pdf" required>
          <div class="error" id="errTicket">Ticket requis (formats : JPG/PNG/PDF â‰¤ 5 Mo).</div>
        </div>

        <div class="full consent">
          <label>
            <input type="checkbox" id="rgpd" name="Consentement" required>
            Jâ€™accepte le rÃ¨glement du jeu et le traitement de mes donnÃ©es (suppression au 31/01/2026).
          </label>
          <div class="error" id="errRgpd">Vous devez accepter le rÃ¨glement.</div>
        </div>
      </div>

      <button type="submit">Envoyer ma participation</button>
    </form>

    <!-- RÃˆGLEMENT INTÃ‰GRÃ‰ -->
    <details style="margin-top:16px;">
      <summary>ðŸ“œ RÃ¨glement du jeu â€” NoÃ«l Bigben Connected</summary>
      <div style="font-size:13px;text-align:left;line-height:1.45;margin-top:8px;">
        <p><strong>Article 1 â€” Organisation</strong><br>
        Le prÃ©sent jeu est organisÃ© par <strong>Bigben Connected</strong>, 65 Rue de la Victoire, 75009 Paris, du <strong>1er au 20 dÃ©cembre 2025</strong> inclus, dans le magasin partenaire <strong>E.Leclerc Bourgoin-Jallieu</strong>.</p>

        <p><strong>Article 2 â€” Principe du jeu</strong><br>
        Le jeu repose sur un tirage au sort avec obligation dâ€™achat : tout client ayant achetÃ© <strong>deux articles Bigben Connected</strong> dans le magasin partenaire peut participer.  
        La participation sâ€™effectue via un <strong>formulaire en ligne</strong> accessible par QR Code, oÃ¹ le participant renseigne ses coordonnÃ©es (nom, prÃ©nom, e-mail, tÃ©lÃ©phone) et tÃ©lÃ©verse la <strong>photo de son ticket de caisse</strong> prouvant lâ€™achat.</p>

        <p><strong>Article 3 â€” Conditions de participation</strong><br>
        Le jeu est ouvert Ã  toute personne majeure rÃ©sidant en France mÃ©tropolitaine, Ã  lâ€™exclusion des salariÃ©s de Bigben Connected, de leurs familles et de toute personne impliquÃ©e dans lâ€™organisation du jeu.  
        Une seule participation par ticket de caisse est autorisÃ©e.</p>

        <p><strong>Article 4 â€” Dates du jeu</strong><br>
        Le jeu est ouvert du <strong>1er dÃ©cembre 2025</strong> au <strong>20 dÃ©cembre 2025</strong>.  
        Le <strong>tirage au sort</strong> aura lieu le <strong>27 dÃ©cembre 2025</strong>.</p>

        <p><strong>Article 5 â€” Lots mis en jeu</strong><br>
          ðŸ¥‡ Appareil photo Polaroid â€” valeur 149 â‚¬<br>
          ðŸ¥ˆ Enceinte Bluetooth â€” valeur 99 â‚¬<br>
          ðŸ¥‰ Ã‰couteurs sans fil FORCE â€” valeur 79 â‚¬<br>
          Les lots ne sont ni Ã©changeables, ni remboursables, ni convertibles en espÃ¨ces.</p>

        <p><strong>Article 6 â€” DÃ©signation des gagnants</strong><br>
        Les gagnants seront tirÃ©s au sort parmi les participations valides.  
        Ils seront contactÃ©s par e-mail ou tÃ©lÃ©phone sous 7 jours.  
        En lâ€™absence de rÃ©ponse sous 15 jours, le lot pourra Ãªtre rÃ©attribuÃ©.</p>

        <p><strong>Article 7 â€” ResponsabilitÃ©</strong><br>
        Lâ€™Organisateur ne saurait Ãªtre tenu responsable de tout dysfonctionnement technique, perte de donnÃ©es ou problÃ¨me liÃ© au rÃ©seau.  
        La participation implique lâ€™acceptation pleine et entiÃ¨re du prÃ©sent rÃ¨glement.</p>

        <p><strong>Article 8 â€” DonnÃ©es personnelles (RGPD)</strong><br>
        Les donnÃ©es collectÃ©es (nom, prÃ©nom, e-mail, tÃ©lÃ©phone, ticket dâ€™achat) sont utilisÃ©es uniquement pour la gestion du jeu et la remise des lots.  
        Elles seront supprimÃ©es au plus tard le <strong>31 janvier 2026</strong>.  
        ConformÃ©ment au RGPD, chaque participant dispose dâ€™un droit dâ€™accÃ¨s, de rectification et de suppression de ses donnÃ©es en Ã©crivant Ã  <strong>dpo@bigben-connected.com</strong>.</p>

        <p><strong>Article 9 â€” Acceptation du rÃ¨glement</strong><br>
        La participation au jeu implique lâ€™acceptation totale du prÃ©sent rÃ¨glement, disponible Ã  tout moment via ce formulaire.  
        Toute rÃ©clamation devra Ãªtre adressÃ©e avant le 31 janvier 2026.</p>

        <p style="margin-top:10px;"><em>Â© Bigben Connected â€” Tirage au sort NoÃ«l 2025</em></p>
      </div>
    </details>
  </div>

  <footer>Â© Bigben Connected â€” Tirage NoÃ«l</footer>

<script>
/* ---------- Helpers ---------- */
const byId=id=>document.getElementById(id);
const form=byId('jeuForm');

const nom=byId('nom'), prenom=byId('prenom'), email=byId('email');
const tel=byId('tel'), montant=byId('montant'), dateA=byId('date'), ticket=byId('ticket');
const rgpd=byId('rgpd'), mag=byId('magasin');

const MAX_FILE_MB=5;
/* URL de remerciement robuste (gÃ¨re sous-dossiers GitHub Pages) */
const THANKS_URL = new URL('./merci.html', location.href).href;

/* Ton URL Apps Script (laisse comme tu l'avais) */
const FLOW_URL='https://script.google.com/macros/s/AKfycbzKUShxRdcZC6z4So2AmJy9W0DK4Xi3N5C7hApnWIV3-sWsIczMo4XubX2Ti9jF-7fY/exec';

function validExt(n,e){return e.includes((n.split('.').pop()||'').toLowerCase());}
function fileToBase64(file){
  return new Promise((resolve,reject)=>{
    const r=new FileReader();
    r.onload=()=>resolve((r.result||'').toString().split(',')[1]||'');
    r.onerror=reject;
    r.readAsDataURL(file);
  });
}

function valider(){
  let ok=true;
  if(nom.value.trim()===''){ok=false;alert('Nom manquant');}
  if(prenom.value.trim()===''){ok=false;alert('PrÃ©nom manquant');}
  if(email.value.trim()===''){ok=false;alert('Email manquant');}
  if(mag.value===''){ok=false;alert('Veuillez sÃ©lectionner un magasin.');}
  if(dateA.value===''){ok=false;alert('Veuillez indiquer la date dâ€™achat.');}
  if(!ticket.files || ticket.files.length===0){ok=false;alert('Veuillez joindre le ticket (JPG/PNG/PDF).');}
  if(!rgpd.checked){ok=false;alert('Veuillez accepter le rÃ¨glement.');}
  return ok;
}

/* ---------- Soumission ---------- */
form.addEventListener('submit', async (e)=>{
  e.preventDefault();
  if(!valider()) return;

  try{
    const f=ticket.files[0];
    const okExt = validExt(f.name,['jpg','jpeg','png','pdf']);
    const okSize = f.size <= MAX_FILE_MB*1024*1024;
    if(!okExt){ alert('Format de ticket invalide (JPG/PNG/PDF uniquement).'); return; }
    if(!okSize){ alert('Ticket trop volumineux (> 5 Mo).'); return; }

    const base64 = await fileToBase64(f);

    const payload={
      nom:(nom.value.trim()+' '+prenom.value.trim()).trim(),
      nom_famille:nom.value.trim(),
      prenom:prenom.value.trim(),
      email:email.value.trim(),
      telephone:tel.value.trim(),
      magasin:mag.value,
      montant_eur:Number(montant.value||0),
      date_achat:dateA.value,
      consentement:rgpd.checked?'oui':'non',
      meta:{ts_iso:new Date().toISOString(),ua:navigator.userAgent},
      ticket:{filename:f.name,mimetype:(f.type||'application/octet-stream'),base64}
    };

    /* Envoi tolerant (mÃªme si CORS strict, on redirige quand mÃªme) */
    const ctrl = new AbortController();
    const timeout = setTimeout(()=>ctrl.abort(), 20000);

    let ok = false, status = 0, txt = '';
    try{
      const resp = await fetch(FLOW_URL, {
        method:'POST',
        headers:{'Content-Type':'text/plain;charset=utf-8'}, // Ã©vite le prÃ©flight
        body:JSON.stringify(payload),
        signal: ctrl.signal
        // keepalive:true // optionnel
      });
      status = resp.status;
      try{ txt = await resp.text(); }catch{}
      ok = resp.ok;
    }catch(err){
      // rÃ©seau/CORS/timeout : on laisse passer, lâ€™UX reste fluide
    }finally{
      clearTimeout(timeout);
    }

    // Redirection immÃ©diate et fiable
    window.location.replace(THANKS_URL);
    console.debug('Submission result:', {ok, status, txt});

  }catch(err){
    console.error(err);
    alert('Erreur dâ€™envoi. VÃ©rifie la connexion et rÃ©essaie.');
  }
});
</script>
</body>
</html>
